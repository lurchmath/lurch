<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Tutorial - Lurch Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Lurch Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../developer/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../getting-started/" class="dropdown-item">Getting started</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Tutorial</a>
</li>
                                    
<li>
    <a href="../plan/" class="dropdown-item">Project plan</a>
</li>
                                    
<li>
    <a href="../bugs-and-enhancements/" class="dropdown-item">Bug fix/enhancement list</a>
</li>
                                    
<li>
    <a href="../example-apps/" class="dropdown-item">Example apps</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../getting-started/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../plan/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#demo-apps-and-app-developer-tutorial" class="nav-link">Demo Apps and App Developer Tutorial</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#example-applications" class="nav-link">Example Applications</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#tutorial" class="nav-link">Tutorial</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="demo-apps-and-app-developer-tutorial">Demo Apps and App Developer Tutorial</h1>
<h2 id="introduction">Introduction</h2>
<h3 id="what-can-i-build-with-this-platform">What can I build with this platform?</h3>
<p>The webLurch <a href="../developer/#a-development-platform">architecture</a> has three
tiers:  The top tier are the applications, built on the middle tier, which
is the <em>Lurch Web Platform</em>, which is built on the bottom tier, the WYSIWYG
editor <a href="http://www.tinymce.com">TinyMCE</a>.</p>
<ul>
<li>TinyMCE provides:</li>
<li>WYSIWYG editing of HTML content
     <br><img alt="" src="../tinymce-screenshot.png" /></li>
<li>Extendability through custom toolbars, menus, dialogs, etc.</li>
<li>The <em>Lurch Web Platform</em> builds on that foundation, and provides:</li>
<li><a href="https://github.com/lurchmath/lurch/blob/master/source/plugins/storageplugin.litcoffee">In-cloud and in-browser storage</a>
     <br><img alt="" src="../save-commands.png" /></li>
<li>A WYSIWYG math editing widget, <a href="https://github.com/foraker/tinymce_equation_editor">imported from
     here</a>
     <br><img alt="" src="../equation-editor.png" /></li>
<li><strong><em>Groups</em></strong>, the most important contribution of the <em>Lurch Web
     Platform</em>, <a href="#what-are-groups">explained below</a>.</li>
<li>Facilities for computing with groups, such as
     <a href="https://github.com/lurchmath/lurch/blob/master/source/auxiliary/background.litcoffee">a background computation/parallelization toolkit</a></li>
</ul>
<h3 id="what-are-groups">What are groups?</h3>
<p>The crux of the user interface for the desktop version of Lurch is the
ability for the user to mark portions of a document as <em>meaningful</em> with
groups.</p>
<p>Groups are represented on screen as "bubbles," as in the images below.  Thus
the terms "group" and "bubble" are sometimes used interchangeably, but
technically "group" is the term for the object in memory, and "bubble" its
representation on screen.</p>
<p>Examples:</p>
<ul>
<li>One demo app lets users wrap bubbles around mathematical expressions to
   tell Lurch to pay attention to the expressions' meaning.  Lurch puts a
   tag above the bubble to let the user see what the content means to Lurch.
   <br><img alt="" src="../bubble-typeset-math.png" /></li>
<li>Another demo app lets users put bubbles around text to give it
   application-specific meaning.  The following screenshot is from an
   application for authoring OpenMath Content Dictionaries.
   <br><img alt="" src="../bubble-OM-CDReviewDate.png" /></li>
<li>Complex nested group hierarchies are possible and very useful.  Desktop
   Lurch uses them constantly:
   <br><img alt="" src="../bubble-many.png" /></li>
</ul>
<p><a href="http://lurchmath.org/2013/04/12/what-have-we-built-so-far-part-1-of-2/">Read about about the importance of this user interface
paradigm in a blog post about the desktop version of
Lurch.</a></p>
<h2 id="example-applications">Example Applications</h2>
<p>There are six example applications built on this platform, each covered on
the <a href="../example-apps/">example applications page</a>.</p>
<h2 id="tutorial">Tutorial</h2>
<p>Build a <em>Lurch Web Application</em> as follows.</p>
<ul>
<li><strong>Phase 1:</strong> Create a web page that imports the <em>Lurch Web Platform</em>.</li>
<li><strong>Phase 2:</strong> Write code that defines a set of group types.</li>
<li><strong>Phase 3:</strong> Optionally add new/custom behaviors to those types.</li>
</ul>
<p>This section gives step-by-step instructions for creating your own <em>Lurch
Web Application.</em>  By the end of this section, you will have completed
Phases 1 and 2 on the list, and will know where to go to explore Phase 3.</p>
<h3 id="phase-1-a-first-app-and-a-very-simple-one">Phase 1: A first app (and a very simple one)</h3>
<ol>
<li>The easiest way to begin is with a working app.  Get a copy of the
    <a href="https://github.com/lurchmath/lwp-example-simple">simple example app</a> as
    follows:<ul>
<li>Visit that page and use the green button to download a .zip of that
  repository to your computer.  Extract its contents.</li>
<li>Run <code>npm install</code> in that folder, then run <code>gulp</code> and be sure that it
  can rebuild the app successfully.</li>
<li>Start up a simple web server in that folder to serve yourself that app
  so that we can be sure it's working:
  <code>python -m SimpleHTTPServer 8000</code></li>
<li>Visit <code>http://localhost:8000</code> to see the simple example app running on
  your machine.</li>
</ul>
</li>
<li>Edit <code>lwp-example-simple.litcoffee</code>.<ul>
<li>The file begins with a lot of documentation, and then the first line
  of code is <code>setAppName 'ExampleApp'</code>.  Change the contents of the
  string to your app's name.</li>
<li>Rebuild using <code>gulp</code> and revisit the page to ensure that the app
  name in the browser's tab has changed to your app's name.</li>
</ul>
</li>
</ol>
<p>You've created a (very simple) app!  And you know how to change your app's
code, rebuild, and visit your updated app.  So what kinds of code changes
are possible?  Let's see.</p>
<h3 id="phase-2-changing-or-adding-group-types">Phase 2: Changing or adding group types</h3>
<p>The individual bubbles you can add to the document in the example app are
the visual representation of what, under the hood, are called "groups."
Each app has a different set of group types that the user may insert in the
document, depending on the needs of the application.  Examples:</p>
<ul>
<li>In the simple app you have, there is only one group type, and it does
   very litte:  It reports the size of its contents and dumps some
   debugging information to the browser console.</li>
<li><a href="https://github.com/lurchmath/lwp-example-complex">The complex demo app</a>
   defines two group types, one for wrapping and evaluating expressions of
   arithmetic and another for wrapping and doing simple computations on
   words.</li>
<li><a href="https://github.com/lurchmath/lwp-example-math">The math demo app</a> has
   nly one group type, for parsing and evaluating mathematical expressions.</li>
<li><a href="https://github.com/lurchmath/lwp-example-openmath">The OpenMath Content Dictionary Editor</a>
   has only one group type, but it can have any of over a dozen different
   purposes, editable using the context menu on each individual group.</li>
</ul>
<p>If we look at the code in your app that defines group types, stripping away
all the documentation, it looks like the following.</p>
<pre><code class="language-coffeescript">window.groupTypes = [
    name : 'reporter'
    text : 'Simple Event Reporter'
    imageHTML : '[ ]'
    openImageHTML : '['
    closeImageHTML : ']'
    tagContents : ( group ) -&gt;
        &quot;#{group.contentAsText()?.length} characters&quot;
    contentsChanged : ( group, firstTime ) -&gt;
        console.log 'This group just changed:', group.contentAsText()
]
</code></pre>
<p>All of this is fully documented <a href="https://github.com/lurchmath/lwp-example-simple/blob/master/lwp-example-simple.litcoffee#define-one-group-type">in the original
file</a>, so I do
not repeat here what any of it means.  But note that this is simply the
assignment to a global variable of an array of group type data.  You could
extend it to add another group type as follows.</p>
<pre><code class="language-coffeescript">window.groupTypes = [
    #
    # This code is the same as before:
    #
    name : 'reporter'
    text : 'Simple Event Reporter'
    imageHTML : '[ ]'
    openImageHTML : '['
    closeImageHTML : ']'
    tagContents : ( group ) -&gt;
        &quot;#{group.contentAsText()?.length} characters&quot;
    contentsChanged : ( group, firstTime ) -&gt;
        console.log 'This group just changed:', group.contentAsText()
    #
    # Here begins the new code:
    #
,
    name : 'myNewGroupType'
    text : 'My New Group Type'
    imageHTML : '{}'
    openImageHTML : '{'
    closeImageHTML : '}'
    tagContents : ( group ) -&gt; 'every tag has this content'
    # no event handler for changes to group contents
]
</code></pre>
<p>Rebuilding your app and reloading it in the browser should then let you
insert either of the two kinds of groups.  Each type should have its own
button on the toolbar.</p>
<p>By simply extending the list above, you can define any set of group types
you see fit in your application.  Note that the open and close HTML can be
arbitrary HTML, including (small) images, font colors, and styles.</p>
<p>The only question that remains is how to make your groups do something
useful.</p>
<h3 id="phase-3-adding-interactivity-to-your-groups">Phase 3: Adding interactivity to your groups</h3>
<p>What else can groups do?  Here are many examples, each with a link to where
you can read more information and see example code.</p>
<p><strong>Report information about the group on the bubble's tag</strong></p>
<ul>
<li>Every example app you've seen so far does this.  Simply search the
   source code repository for the <code>tagContents</code> function and look at the
   variety of implementations.</li>
<li>In computing the contents of the tag, you will want to be able to query
   information about your group, such as its text content, or whether it
   has any groups inside of it.  The API for a Group object is <a href="https://github.com/lurchmath/lurch/blob/master/source/plugins/groupsplugin.litcoffee">documented
   in the source code for the Groups
   Plugin</a>.</li>
</ul>
<p><strong>Customize a group's color</strong></p>
<ul>
<li>Include among the key-value pairs in your group type definition a pair
   like <code>color : '#aacc00'</code>, or whatever HTML color you choose.</li>
</ul>
<p><strong>Store and retrieve custom data in a Group object</strong></p>
<ul>
<li>In the API linked to immediately above, see the <code>set</code>, <code>get</code>, and
   <code>clear</code> functions in the <code>Group</code> class.  These store arbitrary JSON
   data under string keys in a group.</li>
<li>It is very common to do a computation and store its result in an
   attribute of the group, the read that later when computing the contents
   of the group's tag, thus giving the user feedback on the results of
   some background process.</li>
</ul>
<p><strong>Find what groups are in the document</strong></p>
<ul>
<li>For a complete answer, see the API for the <code>Groups</code> class (different
   from the <code>Group</code> class!) in <a href="https://github.com/lurchmath/lurch/blob/master/source/plugins/groupsplugin.litcoffee">the Groups
   Plugin</a>.
   Since that file is large, I give highlights here.</li>
<li>Access the one, global <code>Groups</code> object using the code
   <code>tinymce.activeEditor.Groups</code>.  I call this object <code>Groups</code> hereafter.</li>
<li>Get the array of all group IDs in your document (in the order their
   open boundaries appear in the document) with <code>Groups.ids()</code>.</li>
<li>Get a group object from its ID by indexing <code>Groups</code> as if it were an
   array, as in <code>Groups[someID]</code> or <code>Groups[0]</code>.</li>
<li>For any group <code>G</code>, get the group containing it with <code>G.parent</code>, which
   will be null if the group is top-level in the document, or if it was
   just created in the document (instants ago) and the editor has
   therefore not yet had a chance to re-scan and assign parent/child
   relationships.</li>
<li>For any group <code>G</code>, get an ordered array of the groups it (immediately)
   contains with <code>G.children</code>.  (Same caveat about just-created groups
   applies here.)</li>
</ul>
<p><strong>Pushing complex computations into the background</strong></p>
<ul>
<li>The <em>Lurch Web Platform</em> provides functionality for moving arbitrary
   computations into one or more background threads, with parallelization
   managed efficiently for you.  This lengthy topic is covered in two
   files:</li>
<li><a href="https://github.com/lurchmath/lwp-example-complex">The "complex example" demo app</a>
   pushes some computations into the background, and you can follow its
   example code.</li>
<li><a href="https://github.com/lurchmath/lurch/blob/master/source/auxiliary/background.litcoffee">The background module</a>
   documents the full API that's being leveraged by that demo app.</li>
</ul>
<p><strong>Extending the menus that appear when users right-click a group or click
its bubble tag</strong></p>
<ul>
<li>Extending a group's context menu is done by providing a
   <code>contextMenuItems</code> function in the group type definition.  For an
   example, look for that term in <a href="https://github.com/lurchmath/lwp-example-complex">the source code for the complex example
   demo app</a>.</li>
<li>Extending a group's tag menu is done by providing a <code>tagMenuItems</code>
   function that behaves exactly the same way, but may choose to return a
   different list of menu items.</li>
</ul>
<p><strong>Adding new buttons to the editor toolbar</strong></p>
<ul>
<li>This is done by assigning to the global object
   <code>window.groupToolbarButtons</code>.</li>
<li><a href="https://github.com/lurchmath/lurch/blob/master/source/auxiliary/xml-groups.litcoffee#define-one-toolbar-button">See an example
   here.</a></li>
</ul>
<p><strong>Adding new menu items to the editor's menus</strong></p>
<ul>
<li>This is done by assigning to the global object
   <code>window.groupMenuItems</code>.</li>
<li>There is not an example of this at the moment, but it functions very
   similar to the previous bullet point, about toolbar buttons.  The
   implementation appears in
   <a href="https://github.com/lurchmath/lurch/blob/master/source/auxiliary/setup.litcoffee">the main setup code</a>.</li>
</ul>
<p><strong>Showing dialog boxes</strong></p>
<ul>
<li><a href="http://www.tinymce.com/wiki.php/api4:class.tinymce.WindowManager">TinyMCE provides a few ways to show dialog boxes containing plain
   text</a>.</li>
<li>If your dialog box must contain more than just plain text, see
   <a href="https://github.com/lurchmath/lurch/blob/master/source/plugins/dialogsplugin.litcoffee">the Dialogs plugin</a>.</li>
</ul>
<p><strong>Adding decorations to group boundaries</strong></p>
<ul>
<li>It is common to give feedback to the user about the content of a group
   in a more obvious way than the bubble tag (which is only visible when
   the user's cursor is in the group).  For instance, if there is an
   error in what the user has entered in a group, you might want to
   flag it in an obvious way, as the <font color="red">&#10006;</font>
   does in the following example from
   <a href="https://github.com/lurchmath/lwp-example-openmath">the OpenMath Content Dictionary Editor demo
   app</a>.
   <br><img alt="" src="../bubble-with-error.png" /><br>
   This is a special case of "decorating" a group.  To add decorations to
   a group <code>G</code>, you have the following API.</li>
<li><code>G.set 'openDecoration', 'any valid HTML here'</code> - sets the decoration
   that will appear to the left of its open boundary marker (not used in
   the image above)</li>
<li><code>G.set 'closeDecoration', 'any valid HTML here'</code> - same as the previous
   but for after the close boundary marker (as in the image above)</li>
<li><code>G.clear 'openDecoration'</code> and <code>G.clear 'closeDecoration'</code> behave as
   expected</li>
<li>Note that there are many useful Unicode characters for visually giving
   understandable feedback concisely.  Consider the following, each of
   which can be made more informative by wrapping it in
   <code>&lt;font color="red"&gt;...&lt;/font&gt;</code>, as in the image above,
   or some other color suiting your application.</li>
<li>X's<ul>
<li>&amp;#10006; is &#10006;</li>
<li>&amp;#10007; is &#10007;</li>
<li>&amp;#10007; is &#10008;</li>
</ul>
</li>
<li>Checks<ul>
<li>&amp;#10003; is &#10003;</li>
<li>&amp;#10004; is &#10004;</li>
</ul>
</li>
<li>Stars<ul>
<li>&amp;#10029; is &#10029;</li>
<li>&amp;#10038; is &#10038;</li>
<li>&amp;#10039; is &#10039;</li>
<li>&amp;#10040; is &#10040;</li>
<li>&amp;#10041; is &#10041;</li>
</ul>
</li>
<li>Numbers<ul>
<li>&amp;#10122; is &#10122;</li>
<li>... in order through ...</li>
<li>&amp;#10131; is &#10131;</li>
</ul>
</li>
</ul>
<h3 id="other-functionality">Other functionality</h3>
<p>In this section I document other configuration possibilities beyond those
mentioned above, things that didn't fit neatly into the above categories.</p>
<p>To run any code after the editor has been set up, assign a function to the
global variable <code>window.afterEditorReady</code>.  Your function should accept a
single parameter, <code>editor</code>, which will be the editor object that was just
initialized.  Your function will be called at the end of the TinyMCE editor
"init" event.</p>
<hr />
<p>This tutorial was written by <a href="mailto:ncarter@bentley.edu">Nathan Carter</a>.
Feel free to contact me with questions.  I would love to know how we can
help get you started coding on the <em>Lurch Web Platform</em>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
